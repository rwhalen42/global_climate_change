---
title: "Module 5: Global Climate Change Module"
author: "FREC 3004 Environmental Informatics"
output:
  html_document: default
  github_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
```
## Science question

How do recent rates of global temperature and atmospheric CO2 change compare to 
pre-human rates of change?

## Environmental Learning Objectives:

* To analyze global temperature data to see if Earth’s average global 
  temperatures are increasing
* To analyze CO2 data to see if atmospheric levels are increasing
* To correlate CO2 data with global temperature to see if there is a 
  relationship
* To compare current trends with rates of change during pre-historic periods 
  using ice core data 
* To interpret what these results mean for understanding current climate change 

## Data Science Learning Objectives

* Apply joins to combine data tables

## Assumed R knowledge
* mutate()
* group_by()
* ggplot()
* geom_line()
* geom_point()
* select()
* summarize()
* mean()
* filter()
* rename()
* read_csv()
* lm()
* rbind()
* geom_abline()
* geom_smooth()
* geom_histogram()
* head()
* read_delim()
* rename()
* slice()
* as.numeric()
* paste0()
* for loop
* if-else statement
* ifelse()
* vector()
* geom_hline()

## R knowlege covered in module

* joins (i.e., left_join(), right_join(), etc.)

## Why this matters:

Current climate change is affecting many aspects of the environment, with 
socio-economic consequences. For example, a warmer climate can allow new 
diseases to be introduced and persist (e.g. West Nile became established in the 
United States after an unusually warm winter allowed the mosquitoes that carry 
the virus to survive and spread). We are concerned not only with the actual 
temperature, but also with the rate that the temperature changes. Very rapid 
changes make it more likely that species (maybe even including humans!) cannot 
adapt and will go extinct. 

## Outline:

1.	Determine current rates of air temperature and CO2 change from 
    modern datasets.
2.	Explore whether temperature and CO2 concentrations are related.
3.	Compare current rates to pre-historical rates of change using data 
    from an ice core to investigate how climate has changed in the past. 

## Initiate Project

First, create a directory structure for this module (i.e., project). 

* Create a folder called `FREC3004_Module5_ClimateChange`

Within that folder, create folders for the following

  * `doc`: where you will put text documents associated with the project
  * `data_raw`: where you will put raw data and metadata
  * `results`: where you will save files generated by analysis
  * `src`: where you will save your scripts (i.e., .R or .Rmd files)

Load the tidyverse
```{r, message = FALSE}
library(tidyverse)
library(lubridate)
```

Make sure this files is in the working directory for this module

## Step 1, Part 1: Change in global temperatures

**Acquire data**

Getting the air temperature data

These data are compiled by the Goddard Institute for Space Studies, NASA.  
Visit https://data.giss.nasa.gov/gistemp/ and download the file for 'Global-mean
monthly, seasonal, and annual means'.  This may require right clicking (or in on
a Mac control-clicking) on the csv link and selecting 'Download linked File'.  
Move the downloaded file to your project data directory. The file should be 
called `GLB.Ts+dSST.csv`.

Important: the units of temperature are Celsius but they are provided as an 
anomaly.  An anomaly is the difference from a reference temperature.  To 
calculate the anomaly the mean temperature between 1951-1980 is subtract from 
each raw temperature value.  Therefore, a value of 0.5 is a year that is 0.5 
degree Celsius warmer than the 1951-1980 mean.  It does NOT mean that the 
average temperature was 0.5 Celsius.  Be sure your plots include the units and 
state that it is an anomaly.

**Import data**

Open the dataset in a text editor.  You will notice that the first row is a 
title (`Station: Global Means`) and the second row is the header for each 
column.  This first row will mess up the import of the data if we aren't 
careful.  Fortunately the read_csv function has an option for skipping lines.  
In this case we only want to skip the first line so use `skip = 1`.

```{r}
global_means <- read_csv("data_raw/GLB.Ts+dSST.csv", skip = 1)

view(global_means)
```

You will analyze the annual data, which has a column header of ``J-D``.  To make
the dataset easier to work with you should select only the `Year` and ``J-D`` 
columns.  Call your new dataframe `global_temp_annual`.  Then change the names 
of the the year and temperature columns to `year` and `annual_temp`

```{r}
#INSERT CODE
global_temp_annual <- global_means %>% 
  select("Year", "J-D") %>%
  rename("year" = 1) %>% 
  rename("annual_temp" = 2) %>%
  filter(year < 2020)
global_temp_annual$annual_temp <- as.numeric(global_temp_annual$annual_temp)
head(global_temp_annual)
```

**Visualize data**

Make a scatter plot of temperature change over time. To help guide the eye, add 
a geom layer that calculates a smoothing line through the data: `geom_smooth()`

```{r}
ggplot(data = global_temp_annual, mapping = aes(x = year, y = annual_temp)) +
  geom_point() +
  geom_smooth() +
  labs(x = "Years",
       y = "Celcius (anomalies)") 

```

**Model data**

Now, determine the rate of change. Determining rates of change graphically is 
straightforward. The average rate of change is just the change in temperature 
divided by the change in time, or change in y divided by the change in x, or the
slope of a line that fits through the data. These are all the same thing. Use R 
to calculate the slope of a line using the `lm` function. 

The R-squared (R2) is a statistic resulting from a linear regression analysis, 
which is the statistical name for what you just did by adding a trend line. It 
describes the proportion of variation in the dependent variable explained by the
independent variable. When R2 ~1, the data form a perfectly straight line. As 
the data become more scattered from the line, R2 decreases toward 0. Higher 
R-squared values indicate a stronger relationship between the two variables. 
Record your R2 value down with your slope. 

Examine the summary of the fit below

```{r}
fit <- lm(formula = annual_temp ~ year, global_temp_annual)
summary(fit)
```

**Question 1:**
(provide the answers)

* Equation for the line: y = 0.007429 * x + (-14.439711)

* R2 =  0.75

* Rate of air temperature change (include units): 0.007429 Celcius above 1951-1980 mean temperature

* Given your analysis, is Earth warming? How do you know?: Yes, the Earth is slowly but surely warming up. This can be seen in the upward trend in temperatures and from an R2 value of .75 which shows there is a strong relationship between the increase in temperatures and progressing years.

    
**Model data**

Many scientists claim that drastic changes in global temperature began around 
1950 when fossil-fuel-powered transportation became a mainstay for most 
families. Test this hypothesis by adjusting your trend line so that it only 
looks at the most recent decades, after personal transportation became common. 
You can do this by:

* Create a dateset with data after 1950
* Create a plot just as you did before for the post 1950 period and add the 
  trend line. 

```{r}
post_1950 <- global_temp_annual %>% 
  filter(year > 1950)

ggplot(data = post_1950, mapping = aes(x = year, y = annual_temp)) +
  geom_point() +
  geom_smooth() +
  labs(x = "Years",
       y = "Celcius (anomalies)") 

post_1950_fit <- lm(formula = annual_temp ~ year, post_1950)
summary(post_1950_fit)
```

**Question 2:**
(provide the answers)

* Equation for the line: y = 1.487e-02 * x + (-2.922e+01)

* R2 = 0.87

* Rate of air temperature change (include units): 1.487e-02 Celcius above 1951-1980 mean temperature

* Compare the slopes of these two lines (1880 through 2017 versus 1950 through 
   2017). Does your analyses support the hypothesis that the rate of global 
   average temperature change is increasing through time?
   
   Yes

## Step 2, Part 2: Changes in atmospheric CO2 

In 1958, Dr. Charles David Keeling (1928-2005), who was a scientist at Scripps 
Institute of Oceanography, began collecting data on atmospheric CO2 
concentration at the Mauna Loa Observatory located in Hawaii. This dataset is 
what allowed us to understand the degree to which climate change is human-caused
through our burning of fossil fuels and release of CO2 into the atmosphere. Due
to his scientific achievements, Dr. Keeling was awarded the National Medal of 
Science by President George W. Bush in 2002. This is the highest award for 
lifetime scientific achievement that can be granted in the U.S. Today, you get 
to analyze this same dataset, except that you have more data that was available
to Dr. Keeling and his colleagues, because your dataset extends up to current 
time.

**Acquire data**

Getting the atmospheric CO2 data: The longest measurements of atmospheric CO2 
concentrations have been done in Mauna Loa, Hawaii. The simplest way to access 
the data is directly from the Mauna Loa page. 
http://www.esrl.noaa.gov/gmd/ccgg/trends/

(You can already see some graphs plotted on this page, but since you want to 
analyze these data yourself to determine a rate of change, you will have to 
download them.) Select the ‘Data’ tab. Scroll down to the bottom of the page to
‘Data’. Select “Mauna Loa CO2 annual mean data”

The data will appear as a .txt web page. This is a common format for datasets 
that are relatively small and easily downloadable. There is a lot of text at the
top that describes the dataset. The data are presented as a column of years, the
mean CO2 as ppm (parts per mil, or micromoles per mol of air), and the last 
column is the estimated uncertainty in the annual mean is the standard 
deviation.

**Import data**

This a trickier dataset to read in. Use the skills you have developed in the 
last two modules to read the file in.  

```{r}
co2_data <- read_table("data_raw/co2_annmean_mlo.txt", col_names = TRUE, skip = 56)
view(co2_data)
```

**Visualize data**

As you did for air temperature, plot a graph of CO2 vs time. 

```{r}
gg_co2 <- ggplot(data = co2_data, mapping = aes(x = year, y = mean)) +
  geom_point() +
  geom_smooth() +
  labs(x = "Years",
       y = "Mean CO2 Levels") 
```

**Model data**

Determine the current rate of change for atmospheric CO2 data by fitting a trend
line, as you did for air temperatures.  

```{r}
RoC_fit <- lm(mean ~ year, co2_data)
summary(RoC_fit)
```

**Question 3:**
(provide the answers)

* Equation for the line: y = 1.580e+00 * x + (-2.788e+03)

* R2 = 0.98

*	Rate of air CO2 change (include units): 1.58e+00 ppm of CO2

* Based on your analysis, has atmospheric CO2 concentration increased? How 
confident are you in these results?

Yes, its clear that atmospheric CO2 concentration has increased steadily over the years. The data has an R2 value of 0.98 which confirms there is high correlation between the increase of atmospheric CO2 cocentrations and the course of time

## Step 2: How related are the changes in temperature and CO2?

To determine whether a change in CO2 corresponds well with a change in air 
temperature, you can plot temperature against CO2.To do this using ggplot, you 
will need to combine the temperature and CO2 datasets.

**Transform data**

Combined the temperature and CO2 data using a join.  There are different types 
of joins,  in this case we want to save only the years with both temperature and
co2 data.  Therefore we will use one of the *joins* (left, right, inner, or 
full) we discussed in class (see pages 178 - 186 in Wickham and Golemund and the
"Data Transformation with dplyr Cheat Sheet").  What is the column that we will 
be using to join?  (Note: joins are the key new skill in this lab)

```{r}
#INSERT CODE
temp_co2_data <- inner_join(co2_data, global_temp_annual)
view(temp_co2_data)
```

**Visualize data**

Plot the relationship between CO2 and temperature.  This is a graph with CO2 on 
the x axis and temperature on the y axis. Plot the points but do not plot lines 
to connect the points because this is not a time series plot.

```{r}
ggplot(data = temp_co2_data, mapping = aes(x = mean, y = annual_temp)) +
  geom_point() +
  labs(x = "Mean CO2 Levels",
       y = "Annual Temperatures") 
```

**Model data**

Fit a linear regression to the line and analyze

```{r}
CO2_temp_fit <- lm(annual_temp ~ mean, temp_co2_data)
summary(CO2_temp_fit)
```

**Question 4:**
(provide the answers)

*	Equation for the line: y = 0.0106 * x + (-3.446)

*	R2 = 0.92

*	Based on your analysis, could atmospheric CO2 concentration explain the 
increase in average global temperature?

Yes, atmospheric CO2 concentration seems to explain the increase in average global temperature because there is a strong correlation between the increase in temperature and increase in CO2 concetrations

## Step 3: An exploration of the Vostok Ice Core?

When analyzing Earth’s climate, it is important to remember that Earth is 4.54 
billion years old. Our analyses so far have only looked at recent history. How 
can we compare the recent data to pre-historic time? Are the current rates of 
change similar or different than those the earth has experienced in the past? To
explore this, we can use data taken from ice cores that were drilled at the 
poles. 

Hundreds of ice cores have been extracted from polar ice because they contain 
valuable data on atmospheric chemistry over pre-historic time. These valuable 
data exist in tiny air bubbles that are trapped in the ice. These air bubbles 
contain the same gases in the same ratios as the atmosphere at the time when the
ice formed. The data you will be analyzing today are from ice cores extracted 
from the Vostok research station in Antarctica. As you have probably assumed, 
the depth of the ice core is related to how old the ice is; deep ice is older. 
There are two other variables that you will be analyzing from the ice cores. The
first is temperature, which is reflected by isotopic ratios in the ice of the 
core so that these isotopic ratios can be converted into air temperatures. The 
second variable you will analyze is CO2 concentration, which has been measured 
from air bubbles trapped in the ice. We can use these data to see what rates of 
change were like during this pre-historic period, during which human activity 
has been minimal. 

**Acquire data**

The Vostok ice core data is available through the Carbon Dioxide Information 
Analysis Center (CDIAC) http://cdiac.esd.ornl.gov/. Under the Data dropdown 
menu, select Climate. Then select Temperature. Then down at the bottom of that 
page there is a link called “Historic isotopic temperature record from the 
Vostok Ice core, Antarctica”. Select this link, which provide information about 
the core location, and then select ‘Digital Data’ on the top of the page. 
Download the Vostok ice core data to your `data_raw` directory

**Import data**

This a trickier dataset to read in. I recommend opening the file in a text 
editor and looking at how many lines are present before the first data line and 
at the deliminator that separates values in a line.  Also, you may need to 
rename some of the columns if you are having trouble importing the header row.

```{r}
#INSERT CODE
vostok_temp_data <- read_table("data_raw/vostok.1999.temp.dat.txt", col_names = FALSE, skip = 60)
vostok_temp_data <- vostok_temp_data %>% 
  rename("Depth (m)" = 1) %>% 
  rename("Age of the ice (yr BP)" = 2) %>% 
  rename("Deuterium content of the ice (delta D)" = 3) %>% 
  rename("Temperature Variation (deg C)" = 4)
view(vostok_temp_data)
```


**Transform data**

In these data, the temperature column is not the actual temperature, but is a 
the temperature variation or anomaly. To use actual temperatures you will have 
to calculate them from the ‘delta D’ content. Deuterium, or delta D, stands for 
the relative proportion of two types of hydrogen (2H: 1H). Changes in the 
proportion of these two types of hydrogen in ice-water correlate to the amount 
of evaporation and thus to ocean water temperature. In the next column, 
calculate the paleo-temperature at Vostok based on the formula describing the 
empirical relationship between temperature and deuterium concentration: 

		Temperature (in degrees C) = -55.5 + (delta D + 440) / 6

Create the new variable within the dataframe that is the calculated temperature

```{r}
vostok_temp_data$Paleo_Temperature <- -55.5 + (vostok_temp_data$`Deuterium content of the ice (delta D)` + 440) / 6
vostok_temp_data <- vostok_temp_data %>% 
  rename("Paleo-Temperature (deg C)" = 5)
```

**Visualize data**

Begin with the ice-core temperature data, and graph it using ice age as the 
independent variable. Keep in mind that the x axis refers to how many thousands 
of years ago, so the time axis moves in the opposite direction as what you are 
accustomed to based on previous analyses (i.e., present day is on the left side 
of the figure). This is the custom for research that investigates patterns over 
long time periods.

```{r}
gg <- ggplot(data = vostok_temp_data, mapping = aes(x = vostok_temp_data$`Age of the ice (yr BP)`, y = vostok_temp_data$`Paleo-Temperature (deg C)`)) +
  geom_point() +
  labs(x = "Age of the ice (yr BP)",
       y = "Paleo-Temperature (deg C)") 
```

**Question 5: **
(provide the answers)

To help you orient to these plots, answer the following questions:

*	Do you think these data are a good representation of pre-historic rates of change? 

To the best of my knowledge, yes these data are a good representation of pre-historic rates of change in temperature.

*	Are we currently in a glacial or inter-glacial period? 

We're currently in an inter-glacial period but the plot makes it seem like we're in a glacial period

*	Approximately, how long does a glacial and inter glacial period last?

    * Glacial: Around 12,000 years


    * Interglacial: around 6,000 years but recently its been a long inter-glacial period



**Model and transform data**

Add a trend line to the ice core temperature data and look at the R2 value. 

```{r}
gg + geom_smooth()
vostok_fit <- lm(vostok_temp_data$`Paleo-Temperature (deg C)` ~ vostok_temp_data$`Age of the ice (yr BP)`, vostok_temp_data)
summary(vostok_fit)
```

**Question 6:** Do you think this line is a good representation of long-term 
rates of temperature change? 

**Answer 6:**
No I don't think its a good representation of long-term rates of temperature change because it shows a very generalized line of the temperature changes but it doesn't really show all the sharp spikes and decreases in the temperature

Now, calculate what the fastest rate of temperature change might be. To do this,
visually identify a section of your data where the temperature is changing very 
rapidly. Make note of the x-axis values at the beginning and end of the time 
period segments that you think have the steepest slopes.  Remember a rate of 
change is the temperature change divided by the time change   

[Challenge (not graded): Rather than visually selecting a period, write code to 
find which period in the data is the steepest] 

Using your visual selection or you selection from the challenge, use the x-axis 
values that represent the steepest period to filter the dataset to only be your 
period of interest. Note: if you don't do the challenge you still need make this
plot.

```{r}
vostok_fast_change <- vostok_temp_data %>% 
  filter(vostok_temp_data$`Age of the ice (yr BP)` > 25000 & vostok_temp_data$`Age of the ice (yr BP)` < 50000)
view(vostok_fast_change)
```


**Visualize and model data**

Make a new graph of only your selected time period

```{r}
gg_change <- ggplot(data = vostok_fast_change, mapping = aes(x = vostok_fast_change$`Age of the ice (yr BP)`, y = vostok_fast_change$`Paleo-Temperature (deg C)`)) +
  geom_point() +
  labs(x = "Age of the ice (yr BP)",
       y = "Paleo-Temperature (deg C)") 
```

Determine the rate of change in temperature by fitting a trend line and looking 
at the slope. 

```{r}
gg_change + geom_smooth()
vostok_change_fit <- lm(vostok_fast_change$`Paleo-Temperature (deg C)` ~ vostok_fast_change$`Age of the ice (yr BP)`, vostok_fast_change)
summary(vostok_change_fit)
```

**Question 7:** What is this rate of pre-historic temperature change 
(with units)? 

**Answer 7:**
-2.039e-04 deg Celcius

**Import data**

To download the Vostok ice core CO2 data, under the CDIAC website 
http://cdiac.esd.ornl.gov/  select ‘Atmospheric Trace Gases & Aerosols’. Then 
select ‘Carbon Dioxide (CO2)’.  On the next page there is a link to ‘Vostok, 
Antarctica (Baronla et al.).’ The file name should be `vostok.icecore.co2.txt`. 
Import the data as `vostok_co2_data` and remember to use the correct number of 
line skips. Again, I recommend opening the file in a text editor and looking at 
how many lines are present before the first data line and at the deliminator 
that separates values in a line (be careful with the deliminators!).

```{r} 
vostok_co2_data <- read_delim("data_raw/vostok.icecore.co2.txt", delim = "\t", col_names = FALSE, skip = 20)
vostok_co2_data <- vostok_co2_data %>% 
  rename("Depth (m)" = 1) %>% 
  rename("Age of the ice (yr BP)" = 2) %>% 
  rename("Mean age of the air (yr BP)" = 3) %>% 
  rename("CO2 Concentration (ppmv)" = 4)
view(vostok_co2_data)
```

**Visualize data**

Prepare a plot of CO2 concentration as a function of (gas) age. Plot (gas) age 
on the x axis and CO2 on the y axis.

```{r}
gg_co2_conc <- ggplot(data = vostok_co2_data, mapping = aes(x = `Mean age of the air (yr BP)`, y = `CO2 Concentration (ppmv)`)) +
  geom_point() +
  labs(x = "Mean age of the air (yr BP)",
       y = "CO2 Concentration (ppmv)")
```

**Question 8:** According to the CO2 data from ice cores, during which time 
frame(s) was there the greatest rate of change in atmospheric CO2 concentration? 

**Answer 8:**
Between 25,000 and 50,000 years ago
**Question 9:** How do CO2 concentrations recorded over time in the ice core 
compare to the current values for today, which you can see on the Mauna Loa web 
site? 

**Answer 9:**
The CO2 concentrations recorded over time in the ice core are much lower than they are nowadays 
**Transform and model**

Now make a new graph focused only on a time period of rapid change in CO2. 
 

```{r}
vostok_co2_focus_data <- vostok_co2_data %>% 
  filter(vostok_co2_data$`Age of the ice (yr BP)` > 128000 & vostok_co2_data$`Age of the ice (yr BP)` < 145000)
gg_focus <- ggplot(data = vostok_co2_focus_data, mapping = aes(x = `Mean age of the air (yr BP)`, y = `CO2 Concentration (ppmv)`)) +
  geom_point() +
  labs(x = "Mean age of the air (yr BP)",
       y = "CO2 Concentration (ppmv)")
```

Determine the rate of change by fitting a trend line and looking at the slope.

```{r}
gg_focus + geom_smooth()
focus_fit <- lm(vostok_co2_focus_data$`CO2 Concentration (ppmv)` ~ vostok_co2_focus_data$`Mean age of the air (yr BP)`, vostok_co2_focus_data)
summary(focus_fit)
```

**Question 10:** Compare the fastest natural rate of change in CO2 from the 
ice-core with the modern rate of change from the Mauna Loa data that you 
analyzed earlier in the module. (Remember to check your units are equivalent).

**Answer 10:** 
```{r}
gg_co2_conc
gg_co2
```
**Question 11:** How do current (i.e., since 1950) changes in 
atmospheric CO2 concentration and average global temperature compare to 
pre-historic (i.e., in the past hundreds of thousands of years) changes in these
variables?

**Answer 11:**
Current changes in atmospheric CO2 and temperature are increasing at a steady rate while the CO2 atmospheric concentration and temperature changes in the pre-historic era fluctuated greatly and weren't steadily increasing
**Question 12:** What does this suggest about whether recent changes in 
temperature are due to natural or anthropogenic (human) factors? 

**Answer 12:**
This highly suggests that the recent changes in temperature are due to anthropogenic factors
**Question 13:** It is plausible that recent increase in atmospheric carbon 
dioxide is a result of natural fluctuations and not human-induced?

**Answer 13:**
It could be natural fluctuations but it likely isn't. The CO2 naturally flucated in pre-historic times but never really went above 300ppmv of CO2 while in todays world we have over 400ppmv of atmospheric CO2
## Citation

This module was initially developed as an Excel-based exercise by:

O’Reilly, C.M., D.C. Richardson, and R.D. Gougis. 15 March 2017. Project EDDIE: 
Climate Change. Project EDDIE Module 8, Version 1. 
http://cemast.illinoisstate.edu/data-for-students/modules/climate-change.shtml. 
Module development was supported by NSF DEB 1245707

